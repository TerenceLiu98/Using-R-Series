---
title: "Single-sample and multi-sample test"
author: "Terence Lau"
date: "11/20/2018"
output: word_document
---

```{r}
library(ISwR)
```

# 置信区间和假设检验

##样本的统计推断

### 统计推断

在许多问题中，总体所包含的个体树木巨大， 很难收集所有个体的信息，例如研究某大学的大学生每天上网的时间，公务员每天使用收集的时间，应届大学生工作起薪等等，研究的方法是从总体中抽出一定数量的个体，记为$x_1, x_2, \dots, x_n$ 组成一个样本，然后通过研究样本来推断总体的情况，例如通过样本均值：$\displaystyle \bar{x} = \sum_{i=1}^n x_i$来估计总体样本均值$\mu$， 通过样本方差$\displaystyle s^2 = \frac{1}{n-1} \sum_{i=1}^n(x_i - \bar{x})^2$ 来估计总体方差$\sigma^2$，由于总体分布的种类甚多，上述推断总体均值和方差的方法是否有根据，能否用于不同类型的总体？ 当总体的分布是正态分布是，其均值的估计比较好处理，先来看一个例子：

大米是我国人民主要粮食，根据近年的统计，我国人均年消费大米约 $100$ 千克。 超市在进货时要做好质量检查，并保证每袋大米的质量达到要求，例如某超市销售的 $5$ 公斤装泰国米要求厂家保证大米的重量平均值为$5$千克，重量波动的标准差为$10$克，即，$0.01$千克。

由于大米在称重和包装中存在随机误差，不可能保证每一袋大米正好$5$千克，若用$X$表示一袋米的重量，根据过去的经验，$X$服从正态分布，即，$X \sim N(5, 0.01^2)$，有正太分布的经验准则，任意一代米的重量落在范围：$[\mu - 3\sigma, \mu + 3\sigma] = [4.97, 5.03]$ 的概率为$99.73$, 于是有力邀要求几乎所有米都在这个区间之中，下面是该商场从一批$1000$袋泰国香米的进货中随机抽取的$9$袋称取的重量：$4.99, 4.97, 5.01, 4.98, 4.96, 4.99, 5.02, 5.00, 5.01$， 我们可以看到$4.96 < 4.97$, 那么超市对这批米的重量是否合格应该下什么结论呢？

**通常做法**

1. 计算**样本均值**

$$\bar{x} = \frac{1}{9}(4.99 + \dots + 5.01) = 4.992$$
它略小于总体均值$5$，显然，要求样本均值$\bar{x}$和总体样本$\mu$完全相投一般是做不到的，但他们之间的差距也不能太大($|\bar{x} - \mu|$})，那么如何计算$|\bar{x} - \mu|$的最大值呢。

2. 计算样本**方差**

$$\sigma_{\bar{x}} = \frac{\sigma}{\sqrt{n}}$$
我们可以看出$\sigma_{\bar{x}}$ 的值和总体标准差以及样本量有关，在本例中，$\sigma{\bar{x}} \simeq  0.0033$

#### 总体均值的估计（总体方差 $\sigma$ 未知）

* 总体标准差（方差）未知
* 接近正态分布

这时，我们可以选择 $t$ 分布。

$$\bar{x} \pm t_{df, \alpha/2} \frac{s}{\sqrt{n}}$$
The $t$ value for a fiven confidence level depens upon its degrees of freedom.

Example: Suppose a person weighs himself on a regular basis and finds his weight to be $174 173 174 174 173 174 176 174 177 171 174 173 173 175 175 172 178 173 174 176 176 171 176 175 179$, Construc a $95%$ confidence interavl estimate for weights.

```{r}
x<-c(174, 173, 174, 174, 173, 174, 176, 174, 177, 171, 174, 173, 173, 175, 175, 172, 178, 173, 174, 176, 176, 171, 176, 175, 179)
n <- length(x)
xbar <- mean(x)
se <- sd(x)/sqrt(n)
alpha <- 1-0.95
zvalue <- qt(1-alpha/2,n-1)
ci <- xbar+c(-zvalue*se,zvalue*se)
paste("The confidence Interval is ", "[",as.data.frame(ci)[1,], ",", as.data.frame(ci)[2,], "]")
```

Or, we can use the built-in function:`t,test()`
```{r}
t.test(x)
```

#### COnfidence Interval estimate the Population Mean $\mu$ (with$\sigma$ known )

#### Confidence Interval for a Population Proportion

If the sample size $n$ is large, then a $(1 - \alpha) * 100%$ **confidence interval** for $p$ is
$$\hat{p} \pm z_{\alpha/2} \sqrt{\frac{\hat{p}(1 - \hat{p})}{n}}$$
* where $\hat{p}$ = sample proportion = $\frac{X}{n} = \frac{\text{number of items having the characteristic}}{\text{sample size}}$
* $p = $ population proportion
* $Z = $ cirtical value from the standardized normal distribution
* $n = $ sample size

assuming obth $X$ AND $(1 - P) \times n$ are greater than $5$

Example: A sample of $500$ executives who own their own home revealed $175$ planned to sell their homes and retire to Arizona. Dvelop a $98%$ confidence interval for the proportion of executives that plan to sell and move to Arizona.

```{r}
n <- 500
p <- 175 / 500
mp <- qnorm(1 - (1-0.98) / 2) * sqrt(p * (1 - p) / n)
ci <- p + c(-mp, mp)
paste("My confidence interval is","[",as.data.frame(ci)[1,],",",as.data.frame(ci)[2,],"]")
```

Or, we can use the built-in function: `prop.test()`
```{r}
prop.test(175,500,conf <- 0.98)
```

## 单样本 t 检验

t 检验假设数据来自于一个正态分布。 在单样本的情况下，我们假设数据$x_1, \dots, \x_n$ 来自服从$N (\mu, sigma^2)$ 的独立随机变量， 其中， $N(\mu, \sigma^2)$ 表示均值为 $\mu$，方差为$\sigma^2$ 的正态分布。 我们希望对假设$\mu = \mu_0$ 进行检验。 我们能用样本的均值$\bar{x}$于标准差$s$来估计真是的参数$\mu$和$\sigma$， 但是实际上，我们是无法求出他们的真实值的。

这里，我们提出一个概念：均值的标准误差，或者简称为 SEM(Standard Error of the Mean)。 对于$n$个均值为$\mu$标准差为$\sigma$的随机变量求平均数，SEM 便是用来描述这个平均数的波动性的，它的表达式为：
$$ \text{SEM} = \frac{\sigma}{\sqrt{n}}$$
这个式子表明，如果你尽兴了重复实验，并且求出了每次实验的平均值，那么这些平均值的波动范围会比元数据分布得更窄。它的重要性在于，即使只有一个样本，它也可以通过样本的经验标准差算出一个经验 SEM的结果：$\frac{s}{\sqrt{n}}$。 这个值能告诉我们观察到的均值便利真实值多远是合适的。

对于服从正态分布的数据，我们有一条一般性的准则，有$95%$ 的数据会落在$\mu \pm 2\sigma$ 这个区域，所以， 如果$\mu_0$是真是的平均数，那么$\bar{x}$就应该会在$\mu_0 \pm 2\text{SEM}$中。正式的，我们可以通过计算：
$$t - \frac{\bar{x} - \mu_0}{\text{SEM}}$$
来判断$t$是否落在了一个接受域中。$t$应该以一定的概率落在这个接受与之外，这个概率被称为**显著性水平（confidence interval）**。显著性水平一般为$5%$。**

 有时候你能知道一个效应的产生方向：比如所有可能会让$\mu$不等于$\mu_0$的原因实际上都会让$\mu$偏大。在这种情况下，你可以选择只在$t$落入右尾的情况下拒绝另假设。这种情况下被称为*单边备择假设下的假设检验*。因为讲作为移出拒绝域实际上是把显著性水平减半，所以对于某个给订的水平，单边检验会有更小的临界值。相似的这里的$p$值指的是得到一个大于或者等于当前$t$值的概率，而不是在绝对值上大于当前$t$值了。所以观察到效应如果发生在约定的方向上，那么$p$值也就编程了上一种情况的一半。

Example 详见 R 文档；

## Wilcoxon 符號秩檢驗

t 檢驗在數據並不來自於整台分部時也比較穩定，尤其是在大樣本情況下。不過也許你會希望避免去做出這個假設。這時，最好能使用 *不依賴於分佈的方法* 。這些方法通常都把數據替換成了相應的順序統計量。
